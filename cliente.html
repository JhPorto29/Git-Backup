<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Backups</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js" async></script>
    <script src="script.js" defer></script>
</head>
<body>
    <header class="banner">
        <div class="banner-content"></div>
    </header>
    <h1 id="client-name">Controle de Backups</h1>

    <div class="home-button">
        <button onclick="goHome()">Home</button>
    </div>
    <div class="transport-button">
        <button onclick="goToTransportPage()">Página de Transporte</button>
    </div>

    <form id="data-form">
        <label for="serial">ESN:</label>
        <input type="text" id="serial" name="serial" required>

        <label for="model">Modelo:</label>
        <input type="text" id="model" name="model" required>

        <label for="courier">Nome Courier:</label>
        <input type="text" id="courier-input" name="courier" placeholder="Digite ou selecione um nome">
        <select id="courier-select">
            <option value="">Selecione um Courier</option>
        </select>

        <div class="buttons">
            <button type="submit">Adicionar ESN</button>
        </div>
    </form>

    <h2>Dados Registrados</h2>
    <div class="search-container">
        <select id="search-column">
            <option value="1">ESN</option>
            <option value="2">Modelo</option>
            <option value="3">Data</option>
            <option value="4">Nome Courier</option>
            <option value="5">Tempo no Sistema</option>
        </select>
        <input type="text" id="search-box" placeholder="Digite para pesquisar...">
        <button type="button" id="search-btn">Pesquisar</button>
        <button type="button" id="clear-search-btn">Limpar Pesquisa</button>
    </div>

    <div id="table-container" style="height: 500px; overflow-y: auto;">
        <table id="data-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>ESN</th>
                    <th>Modelo</th>
                    <th>Data</th>
                    <th>Nome Courier</th>
                    <th>Tempo no Sistema</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dados serão adicionados aqui -->
            </tbody>
        </table>
    </div>

    <div class="action-buttons">
        <input type="file" id="import-file" style="display:none;">
        <button type="button" id="import-btn">Importar Excel</button>
        <button id="export-btn">Exportar para Excel</button>
    </div>
    <script>
        document.getElementById('data-form').addEventListener('submit', function(event) {
            event.preventDefault();
            const serial = document.getElementById('serial').value.trim();
            const model = document.getElementById('model').value.trim();
            const courierInput = document.getElementById('courier-input').value.trim();
            const courierSelect = document.getElementById('courier-select');
            const courier = courierInput || courierSelect.value;
            const date = new Date().toLocaleDateString('pt-BR');

            if (!serial || !model || !courier) {
                alert("Todos os campos são obrigatórios!");
                return;
            }

            const table = document.getElementById('data-table').querySelector('tbody');
            let duplicate = false;
            table.querySelectorAll('tr').forEach(row => {
                if (row.cells[1].textContent === serial) {
                    duplicate = true;
                    row.style.backgroundColor = 'red';
                }
            });

            if (duplicate) {
                if (!confirm("ESN já existe! Deseja adicionar mesmo assim?")) {
                    return;
                }
            }

            const row = table.insertRow();
            row.innerHTML = `
                <td>${table.rows.length}</td>
                <td>${serial}</td>
                <td>${model}</td>
                <td>${date}</td>
                <td>${courier}</td>
                <td>0 dias</td>
                <td><button onclick="removeRow(this)">Remover</button></td>
            `;

            document.getElementById('data-form').reset();
            updateTimeColumn();
            populateCourierSelect();
        });

        function populateCourierSelect() {
            const courierSelect = document.getElementById('courier-select');
            const rows = document.querySelectorAll('#data-table tbody tr');
            const couriers = new Set();

            rows.forEach(row => {
                const courierName = row.cells[4].textContent;
                couriers.add(courierName);
            });

            courierSelect.innerHTML = '<option value="">Selecione um Courier</option>';
            couriers.forEach(courier => {
                const option = document.createElement('option');
                option.value = courier;
                option.textContent = courier;
                courierSelect.appendChild(option);
            });
        }

        function removeRow(button) {
            const row = button.closest('tr');
            row.parentElement.removeChild(row);
            updateTimeColumn();
            populateCourierSelect();
        }
    </script>
</body>
</html>
